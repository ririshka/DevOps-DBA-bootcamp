README: Автоматизация деплоя через GitHub Actions

Обзор

В рамках данной работы было выполнено:

Подняты две EC2 машины на AWS с установленным Nginx.

Настроен автоматический деплой веб-сайта из репозитория GitHub на основную и тестовую машины с использованием GitHub Actions.

Реализован Workflow для автоматического запуска и настройки Docker-контейнера с MySQL.

Структура репозитория

main: Результат выполнения первого задания (деплой на основную EC2).

test: Результат выполнения второго задания (деплой на тестовую EC2).

docker: Результат выполнения третьего задания (деплой Docker-контейнера).

Задание 1: Автоматический деплой на основную EC2

Действия:

Поднята EC2 машина с предустановленной Ubuntu.

Установлен и настроен Nginx:

Открыты порты 80 и 443 в Security Groups.

Создана директория /home/ubuntu/cometa.page для временного хранения файлов.

Настроен Workflow в ветке main:

Подключение к серверу через SSH.

Копирование файлов из репозитория в директорию /home/ubuntu/cometa.page.

Перемещение файлов в директорию Nginx /var/www/html и перезагрузка сервера Nginx.

Результат:
После пуша в ветку main происходит автоматический деплой веб-сайта на основную EC2 машину.

Код Workflow:
Файл: .github/workflows/push-to-ec2.yml

Задание 2: Автоматический деплой на тестовую EC2

Действия:

Поднята вторая EC2 машина с предустановленной Ubuntu.

Установлен и настроен Nginx аналогично первому серверу:

Создана директория /home/ubuntu/test.page для временного хранения файлов.

В Nginx настроен другой сайт, чтобы отделить тестовый сервер от основного.

Настроен Workflow в ветке test:

Подключение к тестовому серверу через SSH.

Копирование файлов из репозитория в директорию /home/ubuntu/test.page.

Перемещение файлов в директорию Nginx /var/www/html на тестовой машине и перезагрузка Nginx.

Результат:
При пуше в ветку test происходит автоматический деплой веб-сайта на тестовую EC2 машину.

Код Workflow:
Файл: .github/workflows/push-to-test-ec2.yml

Задание 3: Workflow для Docker

Действия:

На основной EC2 машине установлен Docker.

Настроен Workflow в ветке docker для автоматического запуска MySQL-контейнера:

Запускается контейнер с образом MySQL.

Проброшен порт 3306 для доступа к базе данных.

Установлена переменная окружения MYSQL_ROOT_PASSWORD для задания пароля root пользователя.

Код Workflow:
Файл: .github/workflows/docker-mysql-deploy.yml

Результат:
При пуше в ветку docker запускается контейнер MySQL на основной EC2 машине. Контейнер доступен для подключения на порту 3306.

Используемые технологии

AWS EC2: Виртуальные машины для хостинга Nginx и Docker.

Nginx: Веб-сервер для раздачи страниц.

Docker: Контейнеризация приложений.

GitHub Actions: CI/CD для автоматизации деплоя.

Инструкция по повторению

Создайте две EC2 машины на AWS.

Настройте Security Groups для открытия портов 80, 443 (для Nginx) и 3306 (для Docker).

Настройте переменные secrets в GitHub:

SSH_PRIVATE_KEY: Приватный ключ для SSH.

REMOTE_HOST: IP-адрес основной EC2.

REMOTE_HOST_TEST: IP-адрес тестовой EC2.

REMOTE_USER: Пользователь (например, ubuntu).

TARGET: Директория для файлов (например, /home/ubuntu/cometa.page).

Скопируйте код Workflow из соответствующих веток (main, test, docker).

Выполните пуш в ветку, чтобы инициировать процесс.