# Автоматизация деплоя через GitHub Actions

## Обзор

В данном проекте реализована автоматизация деплоя веб-приложений и настройки Docker-контейнера через GitHub Actions. 

### Что было выполнено:
1. Подняты две EC2 машины на AWS с установленным Nginx.
2. Настроен автоматический деплой веб-сайта из репозитория GitHub на основную и тестовую машины.
3. Реализован Workflow для автоматического запуска Docker-контейнера с MySQL.

---

## Структура репозитория

- **main**: Деплой на основную EC2 машину.
- **test**: Деплой на тестовую EC2 машину.
- **docker**: Настройка и запуск Docker-контейнера с MySQL.

---

## Детали выполнения

### Задание 1: Автоматический деплой на основную EC2

**Действия:**
- Поднята EC2 машина с предустановленной Ubuntu.
- Установлен и настроен Nginx:
  - Открыты порты 80 и 443 в Security Groups.
  - Создана директория `/home/ubuntu/cometa.page` для временного хранения файлов.
- Настроен Workflow в ветке `main`:
  - Подключение к серверу через SSH.
  - Копирование файлов из репозитория в `/home/ubuntu/cometa.page`.
  - Перемещение файлов в директорию Nginx `/var/www/html` и перезагрузка сервера.

**Результат:**
После пуша в ветку `main` веб-сайт автоматически деплоится на основную EC2 машину.

**Код Workflow:** `.github/workflows/push-to-ec2.yml`

---

### Задание 2: Автоматический деплой на тестовую EC2

**Действия:**
- Поднята вторая EC2 машина с предустановленной Ubuntu.
- Установлен и настроен Nginx:
  - Создана директория `/home/ubuntu/test.page`.
  - Настроен отдельный сайт для тестовой машины.
- Настроен Workflow в ветке `test`:
  - Подключение к тестовому серверу через SSH.
  - Копирование файлов из репозитория в `/home/ubuntu/test.page`.
  - Перемещение файлов в директорию `/var/www/html` на тестовой машине и перезагрузка Nginx.

**Результат:**
При пуше в ветку `test` веб-сайт автоматически деплоится на тестовую EC2 машину.

**Код Workflow:** `.github/workflows/push-to-test-ec2.yml`

---

### Задание 3: Workflow для Docker

**Действия:**
- На основной EC2 машине установлен Docker.
- Настроен Workflow в ветке `docker` для автоматического запуска MySQL-контейнера:
  - Запускается контейнер с образом MySQL.
  - Проброшен порт 3306 для доступа к базе данных.
  - Установлена переменная окружения `MYSQL_ROOT_PASSWORD`.

**Результат:**
При пуше в ветку `docker` на основной EC2 машине запускается MySQL-контейнер, доступный на порту 3306.

**Код Workflow:** `.github/workflows/docker-mysql-deploy.yml`

---

## Используемые технологии

- **AWS EC2**: Виртуальные машины для хостинга.
- **Nginx**: Веб-сервер.
- **Docker**: Контейнеризация приложений.
- **GitHub Actions**: CI/CD для автоматизации деплоя.

---

## Инструкция по повторению

1. Создайте две EC2 машины на AWS.
2. Настройте Security Groups для открытия портов:
   - 80, 443 — для Nginx.
   - 3306 — для MySQL.
3. Настройте переменные **secrets** в GitHub:
   - `SSH_PRIVATE_KEY`: Приватный ключ для SSH.
   - `REMOTE_HOST`: IP-адрес основной EC2.
   - `REMOTE_HOST_TEST`: IP-адрес тестовой EC2.
   - `REMOTE_USER`: Пользователь (например, ubuntu).
   - `TARGET`: Директория для временного хранения файлов.
4. Скопируйте код Workflow из соответствующих веток (`main`, `test`, `docker`).
5. Выполните пуш в соответствующую ветку, чтобы инициировать процесс деплоя.

---

